<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kiwi | Lo que necesitas</title>
    <link rel="icon" type="image/png" href="assets/img/logo_kiwi.png">
    <meta name="description" content="Bienvenido a Kiwi, tu tienda de moda favorita.">
    <link rel="stylesheet" href="css/styles.css?v=1.0.1">
    <link rel="stylesheet" href="css/styles-admin.css?v=1.0.1">
    <!-- Fuente moderna (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kiwi">
    <link rel="apple-touch-icon" href="assets/img/apple-touch-icon.png">
</head>

<body>

    <!-- Pantalla de Carga -->
    <div id="pantalla-carga" class="pantalla-completa">
        <div class="contenedor-logo-carga">
            <img src="assets/img/logo_kiwi.png" alt="Logo Kiwi" class="image-logo-carga">
        </div>
    </div>

    <!-- Pantalla de Mantenimiento -->
    <div id="pantalla-mantenimiento" class="pantalla-completa oculto" style="display: none;">
        <div class="contenedor-mantenimiento">
            <h1 class="titulo-mantenimiento">¬°ESTAMOS MEJORANDO PARA TI!</h1>
            <img src="assets/img/Kiwi_mantenimiento.png" alt="Mantenimiento" class="imagen-mantenimiento">
            <p class="descripcion-mantenimiento">Por el momento este Kiwi est√° en mantenimiento, intenta ingresar m√°s
                tarde</p>
        </div>
    </div>

    <!-- Pantalla de Mantenimiento (Video) -->
    <div id="pantalla-mantenimiento-video" class="pantalla-completa">
        <div class="contenedor-mantenimiento">
            <h1 class="titulo-mantenimiento">¬°ESTAMOS MEJORANDO PARA TI!</h1>
            <video class="video-mantenimiento" autoplay muted loop playsinline>
                <source src="assets/video/kiwi_mantenimiento.mp4" type="video/mp4">
                <source src="assets/video/kiwi_mantenimiento.webm" type="video/webm">
                Tu navegador no soporta videos HTML5.
            </video>
            <p class="descripcion-mantenimiento">Por el momento este Kiwi est√° en mantenimiento, intenta ingresar m√°s
                tarde</p>
        </div>
    </div>

    <!-- Pantalla de Login -->
    <div id="pantalla-login" class="pantalla-completa oculto">
        <div class="contenedor-login">
            <!-- Logo Superior -->
            <div class="header-login">
                <div class="animacion-fondo-logo"></div>
                <img src="assets/img/logo_kiwi.png" alt="Logo Kiwi" class="imagen-logo-login">
            </div>

            <div class="contenido-form">
                <!-- Secci√≥n Vendedores -->
                <div class="seccion-formulario">
                    <h2 class="titulo-seccion">VENDEDORES</h2>
                    <form id="form-login-vendedor">
                        <div class="grupo-input">
                            <input type="email" id="email" required placeholder=" ">
                            <label for="email">Correo Electr√≥nico</label>
                        </div>
                        <div class="grupo-input">
                            <input type="password" id="password" required placeholder=" ">
                            <label for="password">Contrase√±a</label>
                        </div>
                        <button type="submit" class="boton-primario">INGRESAR</button>
                    </form>
                </div>

                <div class="separador"></div>

                <!-- Secci√≥n Compradores -->
                <div class="seccion-compradores">
                    <h2 class="titulo-seccion">COMPRADORES</h2>
                    <button id="btn-comprador" class="boton-primario">INGRESAR</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Cat√°logo -->
    <div id="pantalla-catalogo" class="pantalla-completa oculto"
        style="display: none; align-items: flex-start; overflow-y: auto;">
        <div class="contenedor-catalogo">
            <!-- Header Cat√°logo -->
            <header class="header-catalogo">
                <div class="top-bar">
                    <img src="assets/img/logo_kiwi.png" alt="Logo Kiwi" class="logo-pequeno">
                    <div class="buscador-container">
                        <input type="text" placeholder="Qu√© buscas?" id="input-busqueda">
                        <button id="btn-limpiar-busqueda" class="btn-limpiar oculto" aria-label="Limpiar b√∫squeda">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                        </button>
                    </div>
                    <button id="btn-logout" class="btn-icono" aria-label="Cerrar sesi√≥n" style="margin-left: 8px;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"
                            style="color: #D32F2F; transform: rotate(180deg);">
                            <path
                                d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                        </svg>
                    </button>
                </div>

                <!-- Filtros (Chips) -->
                <div class="filtros-container">
                    <button class="chip" data-categoria="Su√©ter">Su√©ter</button>
                    <button class="chip" data-categoria="Blusa">Blusa</button>
                    <button class="chip" data-categoria="Jeans">Jeans</button>
                    <button class="chip" data-categoria="Enterizo">Enterizo</button>
                    <button class="chip" data-categoria="Conjunto">Conjunto</button>
                    <button class="chip" data-categoria="Short">Short</button>
                    <button class="chip" data-categoria="Falda">Falda</button>
                    <button class="chip" data-categoria="Body">Body</button>
                    <button class="chip" data-categoria="Traje">Traje</button>
                    <button class="chip" data-categoria="Licra">Licra</button>
                    <button class="chip" data-categoria="Traje de ba√±o">Traje de ba√±o</button>
                    <button class="chip" data-categoria="Mallas">Mallas</button>
                </div>
            </header>

            <!-- Grid de Productos -->


            <main class="grid-productos" id="grid-productos">
                <!-- Los productos se inyectar√°n aqu√≠ con JS -->
            </main>
        </div>
    </div> <!-- Fin Pantalla Cat√°logo -->

    <!-- Barra de Navegaci√≥n (Ahora fuera, visible globalmente) -->
    <!-- Inicialmente oculta hasta login? Se maneja con z-index o display -->
    <nav class="barra-navegacion oculto" id="barra-navegacion">
        <!-- Indicador animado de fondo -->
        <div class="indicador-activo"></div>

        <button class="nav-item activo" data-tab="inicio">
            <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
            </svg>
        </button>
        <button class="nav-item" data-tab="carrito">
            <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
                <path
                    d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
            </svg>
        </button>
        <button class="nav-item" data-tab="solicitudes">
            <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
                <path
                    d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
            </svg>
        </button>
    </nav>

    <!-- Pantalla de Detalles del Producto -->
    <div id="pantalla-detalle" class="pantalla-completa oculto"
        style="display: none; background-color: #fff; flex-direction: column; overflow-y: auto;">

        <!-- Header Detalle -->
        <header class="header-detalle">
            <button id="btn-atras" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Kiwi" class="logo-header-detalle">
            <div style="width: 24px;"></div> <!-- Espacio para equilibrar header -->
        </header>

        <div class="contenido-detalle">
            <!-- Imagen Principal -->
            <div class="detalle-imagen-contenedor">
                <img id="detalle-imagen" src="" alt="Producto" class="detalle-imagen">
            </div>

            <!-- Info Base -->
            <div class="detalle-info">
                <div class="detalle-header-info">
                    <h1 id="detalle-nombre" class="detalle-nombre">Nombre del Producto</h1>
                    <p id="detalle-precio" class="detalle-precio">$0.00</p>
                </div>

                <p id="detalle-referencia" class="detalle-referencia">Ref: ---</p>

                <!-- Stock Docenas -->
                <p id="detalle-stock" class="detalle-stock">Docenas disponibles: --</p>

                <!-- Selectores -->
                <div class="detalle-selectores">
                    <div class="selector-grupo">
                        <label for="selector-talla">Tallas</label>
                        <select id="selector-talla" class="input-selector" required>
                            <option value="" selected disabled>Seleccionar talla</option>
                        </select>
                    </div>

                    <div class="selector-grupo">
                        <label for="input-cantidad">Cantidad</label>
                        <input type="number" id="input-cantidad" placeholder="Ingresa la cantidad" min="1" max="99"
                            step="1" class="input-selector input-cantidad">
                    </div>
                </div>
            </div>

            <!-- Bot√≥n de Acci√≥n (Est√°tico) -->
            <div class="acciones-detalle" style="margin-top: 0;">
                <button id="btn-agregar-carrito" class="boton-primario">AGREGAR AL CARRITO</button>
            </div>
        </div>
    </div>

    <!-- (Footer Removed) -->
    </div>

    <!-- PANTALLA EDITAR PRODUCTO (Oculta) -->
    <div id="pantalla-editar-producto" class="pantalla-completa oculto">
        <!-- Header -->
        <header class="header-detalle">
            <button id="btn-atras-editar" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Logo Kiwi" style="height: 40px; width: auto; object-fit: contain;">
            <div style="width: 24px;"></div>
        </header>

        <div class="edit-product-content">
            <form id="form-editar-producto">
                <!-- Nombre -->
                <div class="grupo-input">
                    <input type="text" id="edit-nombre" required placeholder=" ">
                    <label for="edit-nombre">Nombre del producto</label>
                </div>

                <!-- Referencia -->
                <div class="grupo-input">
                    <input type="text" id="edit-referencia" required placeholder=" ">
                    <label for="edit-referencia">Referencia</label>
                </div>

                <!-- Categor√≠a (Select) -->
                <div class="grupo-input">
                    <select id="edit-categoria" required class="input-selector"
                        style="width: 100%; height: 50px; border: 1px solid #ccc; border-radius: 8px; padding: 0 12px;">
                        <option value="" disabled selected>Categor√≠a</option>
                        <option value="Su√©ter">Su√©ter</option>
                        <option value="Blusa">Blusa</option>
                        <option value="Jeans">Jeans</option>
                        <option value="Enterizo">Enterizo</option>
                        <option value="Conjunto">Conjunto</option>
                        <option value="Short">Short</option>
                        <option value="Falda">Falda</option>
                        <option value="Body">Body</option>
                        <option value="Traje">Traje</option>
                        <option value="Licra">Licra</option>
                        <option value="Traje de ba√±o">Traje de ba√±o</option>
                        <option value="Mallas">Mallas</option>
                    </select>
                </div>

                <!-- Imagen -->
                <div class="edit-imagen-container" style="margin: 20px 0; text-align: center;">
                    <div id="preview-imagen-container"
                        style="width: 200px; height: 200px; margin: 0 auto; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; cursor: pointer;">
                        <img id="edit-preview-imagen" src="" alt="Preview"
                            style="width: 100%; height: 100%; object-fit: contain; display: none;">
                        <span id="edit-placeholder-img" style="color: #888;">Toca para cambiar imagen</span>
                        <input type="file" id="edit-input-imagen" accept="image/*"
                            style="opacity: 0; position: absolute; inset: 0; cursor: pointer;">
                    </div>
                </div>

                <!-- Tallas (Chips) -->
                <div class="edit-tallas-section">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Conjuntos de tallas:</label>
                    <div id="lista-tallas-chips" class="chips-container"
                        style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;">
                        <!-- Chips inyectados por JS -->
                    </div>

                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="input-nueva-talla" placeholder="Ej: S, M, L"
                            style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 8px;">
                        <button type="button" id="btn-add-talla" class="boton-secundario"
                            style="width: 50px; font-size: 24px; padding: 0; background-color: #000; color: #fff; display: flex; align-items: center; justify-content: center;">+</button>
                    </div>
                </div>

                <div style="height: 20px;"></div>

                <!-- Stock y Precio -->
                <div style="display: flex; gap: 12px;">
                    <div class="grupo-input" style="flex: 1;">
                        <input type="number" id="edit-docenas" required placeholder=" ">
                        <label for="edit-docenas">Docenas</label>
                    </div>

                    <!-- Controles +/- Stock -->
                    <!-- Controles +/- Stock ELIMINADOS -->

                    <div class="grupo-input" style="flex: 1;">
                        <input type="number" id="edit-precio" step="0.01" required placeholder=" ">
                        <label for="edit-precio">Precio x Docena</label>
                    </div>
                </div>

                <div class="edit-actions-container">
                    <button type="submit" class="boton-primario boton-static-force">GUARDAR CAMBIOS</button>
                </div>
                <div style="height: 80px;"></div>
            </form>
        </div>
    </div>



    <!-- PANTALLA CARRITO (Oculta por defecto) -->
    <div id="pantalla-carrito" class="pantalla-completa oculto" style="background-color: #f5f5f5; display: none;">
        <!-- Header Solicitudes (Estilo Carrito) -->
        <div class="header-detalle">
            <button id="btn-atras-carrito" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Kiwi" class="logo-header-detalle">
            <div style="width: 40px;"></div> <!-- Spacer para equilibrar -->
        </div>
        <!-- Lista de Items -->
        <div id="lista-carrito" class="lista-carrito">
            <!-- Items renders por JS -->
        </div>

        <!-- Estado Vac√≠o -->
        <div id="carrito-vacio" class="mensaje-vacio oculto">
            <div class="icono-vacio">üõí</div>
            <p>Tu carrito est√° vac√≠o</p>
        </div>

        <!-- Footer Totales -->
        <div id="footer-carrito" class="footer-carrito-flotante"> <!-- Nueva clase para evitar cach√© antiguo -->
            <div class="info-total">
                <span>Total:</span>
                <span id="total-carrito" class="precio-total">$0.00</span>
            </div>
            <button id="btn-realizar-pedido" class="boton-primario" disabled>PEDIR</button>
        </div>

        <!-- Espacio inferior manejado por CSS -->
    </div>

    <!-- PANTALLA FACTURA (Checkout) -->
    <div id="pantalla-factura" class="pantalla-completa oculto"
        style="background-color: #fff; overflow-y: auto; display: none;">
        <!-- Header Tipo Detalle -->
        <div class="header-detalle">
            <button id="btn-atras-factura" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Kiwi" class="logo-header-detalle">
            <div style="width: 40px;"></div> <!-- Spacer equilibrado con bot√≥n -->
        </div>

        <div class="factura-content">

            <div class="factura-header-texto">
                <h2>Datos para factura no fiscal</h2>
                <p>Coloque sus datos para generar su comprobante de mercanc√≠a.</p>
            </div>

            <form id="formulario-factura" class="factura-form">
                <div class="grupo-input">
                    <input type="text" id="factura-nombre" required placeholder=" ">
                    <label for="factura-nombre">Nombre Completo</label>
                    <span class="mensaje-error"></span>
                </div>

                <div class="grupo-input">
                    <input type="tel" id="factura-celular" maxlength="12" required placeholder=" ">
                    <label for="factura-celular">Celular / WhatsApp</label>
                    <span class="mensaje-error"></span>
                </div>

                <div class="grupo-input">
                    <input type="email" id="factura-email" required placeholder=" ">
                    <label for="factura-email">Correo Electr√≥nico</label>
                    <span class="mensaje-error"></span>
                </div>

                <div class="factura-actions">
                    <button type="submit" id="btn-enviar-pedido" class="boton-primario">
                        ENVIAR
                    </button>
                </div>
            </form>

            <div style="height: 100px;"></div>
        </div>
    </div>

    <!-- PANTALLA SOLICITUDES (Historial) -->
    <div id="pantalla-solicitudes" class="pantalla-completa oculto"
        style="background-color: #f5f5f5; display: none; flex-direction: column; align-items: stretch;">
        <!-- Header Solicitudes (Estilo Carrito) -->
        <div class="header-detalle">
            <button id="btn-atras-solicitudes" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Kiwi" class="logo-header-detalle">
            <div style="width: 40px;"></div> <!-- Spacer para equilibrar -->
        </div>

        <div class="contenido-solicitudes" style="width: 100%; flex: 1; overflow-y: auto;">
            <!-- Lista de Solicitudes (Visible si hay datos) -->
            <div id="lista-solicitudes"
                style="width: 100%; max-width: 600px; margin: 0 auto; display: none; padding: 10px;">
                <!-- Items inyectados por JS -->
            </div>

            <!-- Empty State (Visible por defecto) -->
            <div class="mensaje-vacio">
                <div class="icono-vacio" style="font-size: 48px; margin-bottom: 1rem;">üì¶</div>
                <p>No tienes solicitudes registradas</p>
                <p style="font-size: 12px; margin-top: 0.5rem; color: #aaa;">Tus pedidos aparecer√°n aqu√≠</p>
            </div>
        </div>
    </div>

    <!-- PANTALLA SOLICITUDES VENDEDORA (Admin) -->
    <div id="pantalla-solicitudes-vendedora" class="pantalla-completa oculto"
        style="background-color: #f5f5f5; display: none; flex-direction: column; align-items: stretch; justify-content: flex-start; overflow-y: auto;">
        <!-- Header -->
        <header class="header-detalle" style="background-color: #fff;">
            <button id="btn-atras-solicitudes-vendedora" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Logo Kiwi" class="logo-header-detalle">
            <div style="width: 40px;"></div> <!-- Spacer -->
        </header>

        <div class="vendor-screen-content">
            <!-- Lista de Solicitudes (Visible si hay datos) -->
            <div id="lista-solicitudes-vendedora" class="vendor-request-list">
                <!-- Items inyectados por JS -->
            </div>

            <!-- Empty State -->
            <div id="mensaje-vacio-vendedora" class="mensaje-vacio vendor-empty-state">
                <p>No hay solicitudes registradas.</p>
            </div>
        </div>
    </div>

    <!-- PANTALLA CARRITO (Oculta por defecto) -->
    <!-- (Existente...) -->

    <!-- PANTALLA EDITAR PRODUCTO (Vendedor) -->
    <div id="pantalla-editar-producto" class="pantalla-completa oculto"
        style="background-color: #fff; display: none; flex-direction: column; justify-content: flex-start; align-items: stretch; overflow-y: auto;">
        <header class="header-detalle" style="position: sticky; top: 0; background: white; z-index: 10;">
            <button id="btn-atras-editar" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <span class="titulo-header">Editar Producto</span>
            <div style="width: 40px;"></div>
        </header>

        <div class="edit-product-content">
            <form id="form-editar-producto" class="edit-product-form">

                <!-- 1. Nombre -->
                <div class="grupo-input">
                    <input type="text" id="edit-nombre" required placeholder=" ">
                    <label>Nombre del Producto</label>
                </div>

                <!-- 2. Referencia -->
                <div class="grupo-input">
                    <input type="text" id="edit-referencia" required placeholder=" ">
                    <label>Referencia</label>
                </div>

                <!-- 3. Categor√≠a -->
                <div> <!-- Wrapper simple para etiqueta est√°tica -->
                    <label class="label-titulo-campo">Categor√≠a</label>
                    <div style="position: relative;">
                        <select id="edit-categoria" class="select-moderno">
                            <option value="" disabled selected>Seleccionar</option>
                            <option value="Su√©ter">Su√©ter</option>
                            <option value="Blusa">Blusa</option>
                            <option value="Jeans">Jeans</option>
                            <option value="Enterizo">Enterizo</option>
                            <option value="Conjunto">Conjunto</option>
                            <option value="Short">Short</option>
                            <option value="Falda">Falda</option>
                            <option value="Body">Body</option>
                            <option value="Traje">Traje</option>
                            <option value="Licra">Licra</option>
                            <option value="Traje de ba√±o">Traje de ba√±o</option>
                            <option value="Mallas">Mallas</option>
                        </select>
                        <!-- Arrow Icon hint if needed, but select default is often fine for natives -->
                    </div>
                </div>

                <!-- 4. Imagen -->
                <div class="campo-imagen-edit">
                    <label for="edit-input-imagen" class="imagen-edit-trigger">
                        <img id="edit-preview-imagen" src="" class="imagen-edit-preview">
                        <div id="edit-placeholder-img" class="imagen-edit-placeholder">
                            <span>Toca para cambiar foto</span>
                        </div>
                    </label>
                    <input type="file" id="edit-input-imagen" accept="image/*" style="display: none;">
                </div>

                <!-- 5. Tallas -->
                <div class="tallas-edit-container">
                    <label class="label-titulo-campo">Editar tallas:</label>
                    <div class="input-talla-row">
                        <input type="text" id="input-nueva-talla" placeholder="Ej: S, M, L" class="input-talla-field">
                        <button type="button" id="btn-add-talla" class="btn-add-talla">+</button>
                    </div>
                    <div id="lista-tallas-chips" class="lista-tallas-chips"></div>
                </div>

                <!-- 6. Docenas y Precio (Al Final) -->
                <div style="display: flex; gap: 1rem;">
                    <div class="grupo-input" style="flex: 1;">
                        <input type="number" id="edit-docenas" required placeholder=" ">
                        <label>Docenas</label>
                    </div>
                    <div class="grupo-input" style="flex: 1;">
                        <input type="number" id="edit-precio" required placeholder=" " step="0.01">
                        <label>Precio x Docena</label>
                    </div>
                </div>

                <!-- Bot√≥n STATIC FORCE -->
                <div class="edit-actions-container">
                    <button type="submit" class="boton-primario boton-static-force">GUARDAR CAMBIOS</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PANTALLA AGREGAR PRODUCTO (Vendedor) -->
    <!-- PANTALLA AGREGAR PRODUCTO (Vendedor) -->
    <div id="pantalla-agregar-producto" class="pantalla-completa oculto">
        <header class="header-detalle">
            <button id="btn-atras-agregar" class="btn-icono">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>
            <img src="assets/img/logo_kiwi.png" alt="Kiwi" class="logo-header-detalle">
            <div style="width: 24px;"></div> <!-- Espacio para equilibrar header -->
        </header>

        <div class="add-product-content">
            <form id="form-agregar-producto" class="add-product-form">

                <!-- 1. Nombre -->
                <div class="grupo-input">
                    <input type="text" id="add-nombre" required placeholder=" ">
                    <label>Nombre del Producto</label>
                </div>

                <!-- 2. Referencia -->
                <div class="grupo-input">
                    <input type="text" id="add-referencia" required placeholder=" ">
                    <label>Referencia</label>
                </div>

                <!-- 3. Categor√≠a -->
                <div>
                    <label class="label-titulo-campo">Categor√≠a</label>
                    <div style="position: relative;">
                        <select id="add-categoria" class="select-moderno">
                            <option value="" disabled selected>Seleccionar</option>
                            <option value="Su√©ter">Su√©ter</option>
                            <option value="Blusa">Blusa</option>
                            <option value="Jeans">Jeans</option>
                            <option value="Enterizo">Enterizo</option>
                            <option value="Conjunto">Conjunto</option>
                            <option value="Short">Short</option>
                            <option value="Falda">Falda</option>
                            <option value="Body">Body</option>
                            <option value="Traje">Traje</option>
                            <option value="Licra">Licra</option>
                            <option value="Traje de ba√±o">Traje de ba√±o</option>
                            <option value="Mallas">Mallas</option>
                        </select>
                    </div>
                </div>

                <!-- 4. Imagen -->
                <div class="campo-imagen-edit">
                    <label for="add-input-imagen" class="imagen-edit-trigger">
                        <img id="add-preview-imagen" src="" class="imagen-edit-preview">
                        <div id="add-placeholder-img" class="imagen-edit-placeholder">
                            <span>Toca para agregar imagen</span>
                        </div>
                    </label>
                    <input type="file" id="add-input-imagen" accept="image/*" style="display: none;">
                </div>

                <!-- 5. Tallas -->
                <div class="tallas-edit-container">
                    <label class="label-titulo-campo">Agregar conjunto de tallas:</label>
                    <div class="input-talla-row">
                        <input type="text" id="add-input-nueva-talla" placeholder="Ej: S, M, L"
                            class="input-talla-field">
                        <button type="button" id="btn-add-talla-agregar" class="btn-add-talla">+</button>
                    </div>
                    <div id="add-lista-tallas-chips" class="lista-tallas-chips"></div>
                </div>

                <!-- 6. Docenas y Precio -->
                <div style="display: flex; gap: 1rem;">
                    <div class="grupo-input" style="flex: 1;">
                        <input type="number" id="add-docenas" required placeholder=" ">
                        <label>Docenas</label>
                    </div>
                    <div class="grupo-input" style="flex: 1;">
                        <input type="number" id="add-precio" required placeholder=" " step="0.01">
                        <label>Precio x Docena</label>
                    </div>
                </div>

                <div class="add-actions-container">
                    <button type="submit" class="boton-primario boton-static-force">AGREGAR PRODUCTO</button>
                </div>
            </form>
            <div style="height: 100px;"></div>
        </div>
    </div>
    <!-- Lightbox Zoom Imagen (Reconstruido) -->
    <div id="lightbox-imagen" class="pantalla-completa oculto"
        style="display: none; background-color: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; align-items: center; justify-content: center;">
        <button id="btn-cerrar-lightbox" class="btn-icono"
            style="position: absolute; top: 20px; right: 20px; color: white; background: rgba(0,0,0,0.5); border-radius: 50%; padding: 5px;">
            <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
        </button>
        <img id="img-full-screen" src=""
            style="max-width: 95%; max-height: 90vh; object-fit: contain; border-radius: 8px;">
    </div>

    <!-- Eruda Mobile Debug Console (TEMPORAL - SOLO PARA DEBUG) -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script> <!-- Auth Added -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-functions-compat.js"></script>
    <!-- Functions para Cloud Callable -->
    <!-- FCM para Push Notifications -->

    <!-- jsPDF & AutoTable (Para Comprobantes PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- Di√°logo de Actualizaci√≥n (PWA/Safari) -->
    <div id="update-dialog-overlay" class="dialog-overlay oculto" style="display: none;">
        <div class="dialog-card" style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 1rem;">ü•ùüéâ</div>
            <h3 style="margin-top: 0; font-size: 20px; color: #000;">¬°Nueva Versi√≥n Disponible!</h3>
            <p style="margin: 15px 0; font-size: 15px; color: #555;">
                Hay mejoras y nuevas funciones esper√°ndote.<br>
                Actualiza ahora para disfrutarlas.
            </p>
            <div class="dialog-actions" style="margin-top: 20px;">
                <button id="btn-update-later" class="btn-dialog secundario">M√°s Tarde</button>
                <button id="btn-update-now" class="btn-dialog primario">Actualizar Ahora</button>
            </div>
        </div>
    </div>

    <!-- Custom Dialog (Reemplazo de alert/confirm) -->
    <div id="custom-dialog-overlay" class="dialog-overlay oculto" style="display: none;">
        <div class="dialog-card">
            <h3 id="dialog-titulo" style="margin-top: 0; font-size: 18px;">Atenci√≥n</h3>
            <p id="dialog-mensaje" style="margin: 15px 0; font-size: 14px; color: #555;">Mensaje...</p>
            <div id="dialog-actions" class="dialog-actions">
                <button id="btn-dialog-cancelar" class="btn-dialog secundario">Cancelar</button>
                <button id="btn-dialog-aceptar" class="btn-dialog primario">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Controles Admin (Vendedor) - Flotantes Globales -->
    <div id="controles-admin" class="controles-admin oculto">
        <div class="fab-group">
            <button id="btn-admin-solicitudes" class="fab-admin primario" aria-label="Ver Solicitudes">
                <span style="font-weight: 600; color: #fff;">SOLICITUDES</span>
                <div id="badge-admin-solicitudes" class="badge-notificacion text-badge oculto"></div>
            </button>

            <button id="btn-admin-agregar" class="fab-admin primario" aria-label="Agregar Mercanc√≠a">
                <span style="font-weight: bold; margin-right: 8px;">+</span> AGREGAR MERCANC√çA
            </button>
        </div>
    </div>

    <script src="js/pdfGenerator.js"></script>
    <script src="js/app.js?v=1.0.1"></script>

    <!-- PWA Service Worker Registration - Ejecuci√≥n Inmediata para PWAs -->
    <script>
        // ========================================
        // DETECCI√ìN DE DISPOSITIVO/NAVEGADOR
        // ========================================
        function isPWA() {
            // Detectar si est√° instalado como PWA
            const isPWAStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                window.navigator.standalone === true; // iOS
            console.log('üîç isPWA:', isPWAStandalone);
            return isPWAStandalone;
        }

        function isSafari() {
            // Detectar Safari (incluye iOS Safari)
            const isSafariBrowser = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            console.log('üîç isSafari:', isSafariBrowser);
            return isSafariBrowser;
        }

        function shouldShowUpdateDialog() {
            // Mostrar di√°logo si:
            // 1. Es PWA instalada, O
            // 2. Es Safari (iOS o Mac)
            const shouldShow = isPWA() || isSafari();
            console.log('üîç shouldShowUpdateDialog:', shouldShow);
            return shouldShow;
        }

        // ========================================
        // FUNCIONES DEL DI√ÅLOGO DE ACTUALIZACI√ìN
        // ========================================
        const updateDialog = document.getElementById('update-dialog-overlay');
        let newWorkerWaiting = null;

        function showUpdateDialog(worker) {
            newWorkerWaiting = worker;
            updateDialog.classList.remove('oculto');
            updateDialog.style.display = 'flex';
            console.log('üì¢ Mostrando di√°logo de actualizaci√≥n');
        }

        function hideUpdateDialog() {
            updateDialog.classList.add('oculto');
            updateDialog.style.display = 'none';
        }

        function applyUpdate() {
            if (newWorkerWaiting) {
                console.log('‚úÖ Usuario confirm√≥ actualizaci√≥n, aplicando...');
                newWorkerWaiting.postMessage({ type: 'SKIP_WAITING' });
                hideUpdateDialog();
                // El reload se har√° en el evento 'controllerchange'
            }
        }

        // ========================================
        // EVENT LISTENERS DEL DI√ÅLOGO
        // ========================================
        document.getElementById('btn-update-now').addEventListener('click', applyUpdate);
        document.getElementById('btn-update-later').addEventListener('click', () => {
            console.log('‚è∞ Usuario pospuso actualizaci√≥n');
            hideUpdateDialog();
        });

        // ========================================
        // SERVICE WORKER REGISTRATION - EJECUCI√ìN INMEDIATA
        // ========================================
        if ('serviceWorker' in navigator) {
            // v4 - Revert updateViaCache + Manual Cache Bust
            console.log('[PASO 0] üöÄ Iniciando registro de Service Worker (inmediato)...');

            // IIFE - Se ejecuta inmediatamente sin esperar 'load'
            (async function registerServiceWorker() {
                try {
                    // Registrar Service Worker (Sin opciones extra que rompen iOS)
                    const registration = await navigator.serviceWorker.register('./service-worker.js');
                    console.log('[PASO 1] ‚úÖ Service Worker registrado:', registration.scope);

                    // Para PWAs: "Empuj√≥n" manual al cach√©
                    if (isPWA()) {
                        console.log('[PASO 2] üì± PWA detectada - Iniciando protocolo de actualizaci√≥n...');

                        // TRUCO: Hacemos un fetch manual con timestamp para despertar al cach√©
                        try {
                            await fetch('./service-worker.js?poke=' + Date.now(), { cache: 'no-store' });
                            console.log('[PASO 2.5] ‚ö° Cach√© "despertado" con fetch manual');
                        } catch (e) {
                            console.log('‚ö†Ô∏è Fall√≥ poke, continuando normal');
                        }

                        console.log('[PASO 2.8] üîÑ Ejecutando registration.update()...');
                        await registration.update();
                        console.log('[PASO 3] üîÑ Verificaci√≥n forzada completada');
                    }

                    // Funci√≥n para manejar actualizaciones encontradas
                    function handleUpdateFound(reg) {
                        const newWorker = reg.installing;
                        if (!newWorker) return;

                        console.log('[PASO 4] üîÑ Nueva versi√≥n del Service Worker detectada');

                        newWorker.addEventListener('statechange', () => {
                            console.log(`[PASO 5] üìä Estado del SW: ${newWorker.state}`);

                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Hay una nueva versi√≥n disponible
                                console.log('[PASO 6] ‚ú® Nueva versi√≥n instalada y lista');

                                // ESTRATEGIA H√çBRIDA:
                                if (shouldShowUpdateDialog()) {
                                    // PWA o Safari: Mostrar di√°logo
                                    console.log('[PASO 7A] üì± PWA/Safari detectado ‚Üí Mostrando di√°logo de actualizaci√≥n');
                                    showUpdateDialog(newWorker);
                                } else {
                                    // Chrome/Desktop: Auto-reload
                                    console.log('[PASO 7B] üíª Chrome/Desktop detectado ‚Üí Auto-actualizaci√≥n en 1 segundo...');
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 1000);
                                }
                            }
                        });
                    }

                    // Escuchar evento updatefound
                    registration.addEventListener('updatefound', () => handleUpdateFound(registration));

                    // Para PWAs: Tambi√©n verificar si ya hay un SW waiting
                    if (registration.waiting && isPWA()) {
                        console.log('‚ö†Ô∏è Ya hay un SW esperando - Mostrando inmediatamente');
                        handleUpdateFound(registration);
                    }

                    // Verificar actualizaciones peri√≥dicamente (cada 30 segundos para PWA, 60 para otros)
                    const updateInterval = isPWA() ? 30000 : 60000;
                    console.log(`‚è±Ô∏è Verificando actualizaciones cada ${updateInterval / 1000}s`);

                    setInterval(() => {
                        console.log('üîÑ Verificaci√≥n peri√≥dica de actualizaciones...');
                        registration.update();
                    }, updateInterval);

                    // Detectar cuando el SW toma control (despu√©s de skipWaiting)
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        console.log('üîÑ Service Worker actualizado, recargando p√°gina...');
                        window.location.reload();
                    });

                    // Para PWAs: Verificar actualizaciones cuando la app vuelve a estar visible
                    if (isPWA()) {
                        document.addEventListener('visibilitychange', () => {
                            if (!document.hidden) {
                                console.log('üëÅÔ∏è App visible - Verificando actualizaciones...');
                                registration.update();
                            }
                        });
                    }

                } catch (err) {
                    console.error('‚ùå Error al registrar Service Worker:', err);
                }
            })();
        } else {
            console.warn('‚ö†Ô∏è Service Worker no soportado en este navegador');
        }
    </script>
</body>

</html>